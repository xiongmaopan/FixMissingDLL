---
// DLL 字母分类页 - 按首字母浏览 DLL 文件
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getAllDlls } from '../../../data/dllDatabase';
import { generateBreadcrumbSchema } from '../../../utils/seo';

// 获取所有 DLL 并按字母分组
const allDlls = getAllDlls();
const letterMap: Record<string, typeof allDlls> = {};

allDlls.forEach(dll => {
  const firstChar = dll.name.charAt(0).toUpperCase();
  // 数字开头的归类到 'num'
  const letter = /[0-9]/.test(firstChar) ? 'num' : firstChar.toLowerCase();
  if (!letterMap[letter]) {
    letterMap[letter] = [];
  }
  letterMap[letter].push(dll);
});

// 静态路径生成
export function getStaticPaths() {
  const allDlls = getAllDlls();
  const letterSet = new Set<string>();
  
  allDlls.forEach(dll => {
    const firstChar = dll.name.charAt(0).toUpperCase();
    const letter = /[0-9]/.test(firstChar) ? 'num' : firstChar.toLowerCase();
    letterSet.add(letter);
  });
  
  // 确保所有字母都有页面（即使是空的）
  'abcdefghijklmnopqrstuvwxyz'.split('').forEach(l => letterSet.add(l));
  letterSet.add('num');
  
  return Array.from(letterSet).map(letter => ({
    params: { letter },
    props: { letter }
  }));
}

const { letter } = Astro.props;
const dlls = letterMap[letter] || [];
const sortedDlls = [...dlls].sort((a, b) => a.name.localeCompare(b.name));

// 显示用的字母
const displayLetter = letter === 'num' ? '#' : letter.toUpperCase();
const letterTitle = letter === 'num' ? 'Numeric (0-9)' : `Letter ${displayLetter}`;

const title = `DLL Files Starting with ${displayLetter} - Download & Fix | FixMissingDLL`;
const description = `Browse and download DLL files starting with "${displayLetter}". ${dlls.length} verified DLL files available for Windows 11/10.`;

const breadcrumbs = [
  { name: 'Home', url: 'https://fixmissingdll.com/' },
  { name: 'DLL Directory', url: 'https://fixmissingdll.com/dll/' },
  { name: `${letterTitle}`, url: `https://fixmissingdll.com/dll/letter/${letter}/` }
];

// 所有字母列表用于导航
const allLetters = [...'abcdefghijklmnopqrstuvwxyz'.split(''), 'num'];
---

<BaseLayout 
  title={title}
  description={description}
  canonicalUrl={`https://fixmissingdll.com/dll/letter/${letter}/`}
>
  <script type="application/ld+json" set:html={JSON.stringify(generateBreadcrumbSchema(breadcrumbs))} />
  
  <div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-6">
      <ol class="flex items-center space-x-2">
        <li><a href="/" class="text-blue-600 hover:underline">Home</a></li>
        <li class="text-gray-400">/</li>
        <li><a href="/dll/" class="text-blue-600 hover:underline">DLL Directory</a></li>
        <li class="text-gray-400">/</li>
        <li class="text-gray-600">{letterTitle}</li>
      </ol>
    </nav>

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">
        DLL Files Starting with "{displayLetter}"
      </h1>
      <p class="text-lg text-gray-600">
        {dlls.length > 0 
          ? `Browse ${dlls.length} DLL files starting with "${displayLetter}". All files are verified and safe to download.`
          : `No DLL files starting with "${displayLetter}" found in our database.`
        }
      </p>
    </div>

    <!-- A-Z Quick Navigation -->
    <div class="bg-gray-100 rounded-lg p-4 mb-8">
      <h2 class="text-lg font-semibold mb-3">Browse by Letter</h2>
      <div class="flex flex-wrap gap-2">
        {allLetters.map(l => (
          <a 
            href={`/dll/letter/${l}/`}
            class:list={[
              "w-10 h-10 flex items-center justify-center rounded-lg font-semibold transition-colors",
              l === letter 
                ? "bg-blue-600 text-white" 
                : "bg-white shadow hover:bg-blue-600 hover:text-white"
            ]}
          >
            {l === 'num' ? '#' : l.toUpperCase()}
          </a>
        ))}
      </div>
    </div>

    <!-- DLL List -->
    {dlls.length > 0 ? (
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="px-6 py-4 bg-gray-50 border-b">
          <h2 class="text-xl font-semibold text-gray-900">
            {dlls.length} DLL Files
          </h2>
        </div>
        
        <div class="divide-y divide-gray-100">
          {sortedDlls.map(dll => (
            <a 
              href={`/dll/${dll.id}/`}
              class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition-colors"
            >
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="font-semibold text-gray-900">{dll.name}</h3>
                  <p class="text-sm text-gray-500">{dll.associatedSoftware}</p>
                </div>
              </div>
              <div class="text-right hidden sm:block">
                <div class="text-sm text-gray-600">{dll.size} • {dll.architecture}</div>
                <div class="text-xs text-gray-400">
                  {(dll.downloadCount / 1000).toFixed(0)}K downloads
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    ) : (
      <div class="bg-white rounded-lg shadow p-12 text-center">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">No DLL Files Found</h3>
        <p class="text-gray-600 mb-6">
          There are no DLL files starting with "{displayLetter}" in our database yet.
        </p>
        <a 
          href="/dll/"
          class="inline-flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Browse All DLLs
        </a>
      </div>
    )}

    <!-- Back to Directory -->
    <div class="mt-8 text-center">
      <a 
        href="/dll/"
        class="text-blue-600 hover:text-blue-700 font-medium inline-flex items-center gap-1"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to DLL Directory
      </a>
    </div>
  </div>
</BaseLayout>
